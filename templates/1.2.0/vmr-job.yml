- name: {{ name }}
  templates:
  -  {name: docker, release: docker}
  -  {name: prepare_vmr, release: solace-vmr}
  -  {name: containers, release: solace-vmr}
  -  {name: vmr_agent, release: solace-vmr}
  persistent_disk: 20480
  instances: {{ numInstances }}
  resource_pool: common-resource-pool
  networks:
  - name: test-network
    static_ips:
    {% for ip in static_ips %}
      - {{ ip }}
    {% endfor %}
  properties:
    pool_name: {{ poolName }}
    vmr_agent_port: 18080
    starting_port: 7000
    broker_user: 'solacedemo'
    broker_password: 'solacedemo'
    broker_hostname: 'solace-messaging.local.pcfdev.io'
    heartbeat_rate: 15000
    admin_password: 'admin'
    admin_user: 'admin'
    semp_port: 8080
    semp_ssl_port: 943
    ssh_port: 2222
    system_domain: 'local.pcfdev.io'
    syslog_config: 'disabled'
    cf_api_host: 'api.local.pcfdev.io'
    cf_client_id: 'solace_router'
    cf_client_secret: '1234'
    cf_organization: 'solace'
    cf_space: 'solace-messaging'
    tcp_routes_enabled: 'disabled'
    tls_config: {{ 'enabled' if usingCerts else 'disabled' }}
    {% if usingCerts %}
        {% filter indent(4, true) %}
            {% include 'cert.yml' %}
        {% endfilter %}
    {% endif %}

    containers:
      - name: solace
        image: solace-bosh
        memory: 4G
        dockerfile: |
          {{ solaceDockerFile|indent(10, false) }}
        env_vars:
         - "NODE_TYPE=MESSAGE_ROUTING_NODE"
         - "SERVICE_SSH_PORT=2222"
         - "ALWAYS_DIE_ON_FAILURE=1"
         - "USERNAME_ADMIN_PASSWORD=admin"
         - "USERNAME_ADMIN_GLOBALACCESSLEVEL=admin"
        encrypted_vars:
         - "DEBUG_USERNAME_ROOT_ENCRYPTEDPASSWORD=solace1"
        net: host
        shm_size: 2G
        privileged: true
        uts: host
        volumes:
        - /var/vcap/store/prepare_vmr/volumes/jail:/usr/sw/jail
        - /var/vcap/store/prepare_vmr/volumes/var:/usr/sw/var
        - /var/vcap/store/prepare_vmr/volumes/internalSpool:/usr/sw/internalSpool
        - /var/vcap/store/prepare_vmr/volumes/adbBackup:/usr/sw/adb
        - /var/vcap/store/prepare_vmr/volumes/adb:/usr/sw/internalSpool/softAdb
